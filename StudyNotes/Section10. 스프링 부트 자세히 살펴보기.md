지금까지 살펴본 스프링부트의 자동 구성 정보 원리를 실제 스프링부트의 동작에서 알아본다.

# 스프링 부트의 자동 구성과 테스트로 전환

- `@JdbcTest` : embedded dataSource를 사용한다. 테스트용 db보다 훨씬 빠르게 테스트 가능하다. 기본적으로 트랜잭션이 적용되어 성공적으로 실행하면 롤백함.
- `@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.*NONE*)` : 스프링 애플리케이션 컨텍스트를 로드하되, 서블릿 컨테이너는 시작하지 않는다. db나 외부 종속성이 없는 서비스 계층의 테스트에서 사용할 수 있다. 스프링 트랜잭션 설정을 하지 않으므로 db를 사용하는 테스트는 롤백되지 않을 수 있음. 그래서 `@Transactional`을 붙여야한다.
- `@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.*DEFINED_PORT*)` : 애플리케이션을 실행할 때 임의의 포트 대신 지정된 포트를 사용하도록 설정한다.

# 스프링 부트의 자동 구성 흐름

![스크린샷 2023-05-07 오전 11.03.23.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d06f9265-a2e7-4edb-9c05-7c7a12f11e2a/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-05-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.03.23.png)

1. 사용 기술 선택 : 자바 or 코틀린, Web or Mobile, Servlet(스레드 기반 동기 - spring mvc) or Reactive(비동기 - spring webflux, 데이터 액세스 방식, 보안, 캐싱, 클라우드 등등
2. Spring Initializr : 프로젝트 템플릿 생성
3. build.gradle에 클래스 및 라이브러리 추가 : Springboot Starter과 Dependencies 등
4. 스프링의 자동 구성 빈 준비
    1. 자동구성 후보 로딩 : @AutoConfiguration이 붙은 인프라 스트럭처 빈들의 컨피그 클래스
    2. 조건부 자동구성 : @Conditional의 매칭 조건이 참이면 빈으로 등록. 임포트된 라이브러리에 클래스 존재 유무나 컨테이너 빈 등록 여부에 따라 조건 작성.
    3. 디폴트 자동 구성 인프라 빈 : 인프라 빈이 디폴트 속성 정보를 가진 상태로 준비됨.
    4. 외부 환경 설정값 주입 : 외부의 다양한 프로퍼티 소스를 추상화된 env로 읽어서 인프라 빈에 설정값을 세팅함.
5. 사용자 구성 빈 준비 - 컴포넌트 스캔 방식
    1. 애플리케이션 로직 빈 : @Component
    2. 커스톰 인프라 빈 : @Configuration
    3. 추가 인프라 빈 : 스프링에서 사용하는 서드파티 기술의 인프라 스트럭처 빈
6. 자동 구성 인프라스트럭처 빈 : 커스톰 인프라 빈이 자동구성 인프라 빈을 대체하여 등록됨
7. 유저 구성 애플리케이션 빈 : 애플리케이션 로직 빈, 추가 인프라 빈 등록

그래서 어떤 기술을 선택하고, 그 기술을 제공하는 스프링의 인프라 스트럭처 빈은 무엇이고, 어떤 설정값을 주입할 수 있고, 어떤 조건으로 등록되는가? 스프링부트가 등록해주는 빈들을 살펴보면 백엔드 개발에 필요한 다양한 기술이 무엇인지 알 수 있다. 거기에서 시작해 기술을 익히고 활용하면 더 풍성한 개발이 가능하다.

# 자동 구성 분석 방법

스프링부트가 제공하는 자동구성이 어떤 것이 적용되는지, 어떻게 이용할 수 있는지 그 방법을 알아보자. 이 방법을 통해 스프링부트의 코어 모듈(web, jdbc) 없이 포함되는 자동구성은 어떤 것이 있는지 알아보자.

1. 자동구성 클래스 Condition 결과 로그 : 스프링이 제공하는 imports 파일의 모든 등록 후보 빈을 보여준다.
2. 자동구성 클래스 Condition 결과 빈 ConditionEvaluationReport : 직접 코드를 작성해서 자동구성의 조건을 확인해본다. 원하는 빈만 확인할 수 있다.
3. 최종으로 등록된 빈 확인 ListableBeanFactory : 스프링 컨테이너에 포함된 인터페이스.
4. 컨피그 빈에 해당하는 문서에서 관련 기술, 자동구성, 프로퍼티 확인
5. 라이브러리 코드에서 자동 구성 클래스와 조건, 빈 확인 : @AutoConfiguration, @Conditional, Condition, @Bean
6. 프로퍼티 클래스와 바인딩 정보 확인 : Properties, Bind, Customizer(오브젝트의 기본 설정을 바꾸는 객체. 프로퍼티 클래스에 주입한다), Configurer(스프링 fw의 주요 설정을 바꿀 수 있는 인터페이스)

그외의 TIP

- 자동구성되는 빈(스프링 fw, 자바 표준, 오픈소스 기술 등)을 잘 모르는 경우, 용도 정도만 공부해두면 나중에 활용할 수 있음.
- 프로퍼티가 enum 타입인 경우, 어떤 옵션을 사용할 수 있는지 스프링 레퍼런스 확인. 라이브러리가 추가되는 경우에 따라 조건을 다르게 줄 수도 있다.